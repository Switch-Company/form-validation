/**
 * @switch-company/form-validation - Extend checkvalidity of forms and trigger invalid and valid events on fields
 * @version v1.0.1
 * @link https://www.npmjs.com/package/@switch-company/form-validation
 * @license ISC
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.formValidation=t()}(this,function(){"use strict";var e=new Map;function t(e,t,i){var n={bubbles:!0,cancelable:!1};i&&(n.detail=i);var a=new window.CustomEvent(t,n);e.dispatchEvent(a)}var i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function e(t,i,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in a)return a.value;var l=a.get;return void 0!==l?l.call(n):void 0},r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},l=function(){function a(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,a),this.el=n,this.el.validator=this,this._invalid=[],this._customRules=r.customRules||[],this._fieldValidation=function(i,n){var a=i.validity.valid,r=e.has(i.name),l={validityState:"valid",wasInvalid:r};if(!a){var o=[];for(var s in i.validity)i.validity[s]&&o.push(s);if(o.includes("customError")){var u=e.get(i.name);r&&u!==i.value?(a=!0,i.setCustomValidity("")):(l.message=i.validationMessage,l.validityState="customError")}else l.validityState=o[0]}return n&&a&&!i.disabled&&(i.required||i.value.length>0)&&n.every(function(e){if(i.matches(e.match)){var t=e.test(i);return!(!t||"string"==typeof t)||(l.validityState=t||"customError",e.message&&(i.setCustomValidity(e.message),l.message=e.message),!1)}return!0}),"valid"===l.validityState?(e.delete(i.name),t(i,"valid",l)):(e.set(i.name,i.value),l.message||(l.message=""),t(i,"invalid",l)),"valid"===l.validityState}.bind(this)}return n(a,[{key:"_checkSingleValidity",value:function(e){var t=this._fieldValidation(e,this._customRules),i=this._invalid.indexOf(e);return t||-1!==i?t&&i>-1&&this._invalid.splice(i,1):this._invalid.push(e),t}},{key:"checkValidity",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.el;return t.elements||"FIELDSET"===t.nodeName?(this._invalid.length=0,Array.from(t.elements||t.querySelectorAll("input, textarea, select")).forEach(function(t){t.willValidate&&"submit"!==t.type&&e._checkSingleValidity(t)}),0===this._invalid.length):this._checkSingleValidity(t)}},{key:"invalid",get:function(){return this._invalid}}]),a}();return function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l),n(t,[{key:"_checkSingleValidity",value:function(e){var i=a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_checkSingleValidity",this).call(this,e),n=e.closest("fieldset");if(!n)return i;var r=this.fieldset(n),l=r._invalid.indexOf(e);return i||-1!==l?i&&l>-1&&r._invalid.splice(l,1):r._invalid.push(e),i}},{key:"checkValidity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.el;if("FIELDSET"!==e.nodeName)return a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"checkValidity",this).call(this,e);var i=this.fieldsets.find(function(t){return t.el==e});return i?i.checkValidity():void 0}},{key:"fieldset",value:function(e){if(this.el.contains(e))return e.validator||new l(e,{customRules:this._customRules})}},{key:"setValidity",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Array.from(this.el.elements).forEach(function(i){if(i.willValidate&&"submit"!==i.type){var n=i.validationMessage,a=t[i.name]||"";i.setCustomValidity(a),n!==a&&e._checkSingleValidity(i)}})}},{key:"fieldsets",get:function(){var e=this;return Array.from(this.el.querySelectorAll("fieldset")).map(function(t){return t.validator||new l(t,{customRules:e._customRules})})}}]),t}()});
